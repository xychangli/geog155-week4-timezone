<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Week 4 Time Zone Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 900px;
            margin: 20px;
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>

<h2 style="text-align: center;">时区边界可视化</h2>
<div id="map"></div>

<!-- Import Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // const initialCenter = [40.82, -96.70];  // Map center UNL City Campus
    const bounds = L.latLngBounds([-90, -180], [90, 180]);  // Restrict world, cannot drag unlimited

    const map = L.map('map', {
        worldCopyJump: false,
        maxBounds: bounds,
        maxBoundsViscosity: 0.9,
        minZoom: 2
    });

    // Load OpenStreetMap base map
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Load time zone geojson file
    fetch('data/timezones_wVVG8.geojson') // From: https://github.com/treyerl/timezones/tree/master
        .then(response => response.json())
        .then(data => {
            // 创建时区图层
            const timezoneLayer = L.geoJSON(data, {
                style: {
                    color: "black",      // Edge color
                    weight: 1,         // Edge width
                    fillColor: "transparent", // Fill color
                    fillOpacity: 0    // Fill opacity
                },
                onEachFeature: function(feature, layer) {
                    // Add mouse interaction
                    layer.on({
                        mouseover: function(e) { // Mouse hover turn red
                            layer.setStyle({
                                weight: 2,
                                color: "red",
                                fillColor: "red",
                                fillOpacity: 0.2
                            });
                            layer.bringToFront(); // Make current time zone on top
                        },
                        mouseout: function(e) { // Mouse leave turn black
                            layer.setStyle({
                                weight: 1,
                                color: "black",
                                fillColor: "transparent",
                                fillOpacity: 0
                            });
                        }
                    });

                    // Pop up bubble
                    if (feature.properties) {
                        const popupContent = `
                            <div class="info">
                                Time Zone: <b>UTC${feature.properties.name || 'Unknown time zone'}</b><br>
                            </div>
                        `;
                        layer.bindPopup(popupContent);
                    }
                }
            }).addTo(map);

            // Auto zoom to data boundary
            map.fitBounds(timezoneLayer.getBounds());
        })
        .catch(error => {
            console.error('加载时区数据失败:', error);
            alert('无法加载时区数据，请检查控制台错误信息');
        });
</script>

</body>
</html>